{% extends "base.html" %}

{% block title %}Agent - RTA Break Tracker{% endblock %}

{% block content %}
<div class="app-container">
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <h1>ğŸ–¥ï¸ RTA Break Tracker</h1>
        </div>
        <div class="header-right">
            <span class="user-info">ğŸ‘¤ {{ user.full_name }}</span>
            <a href="{{ url_for('logout') }}" class="btn btn-danger">ğŸšª Logout</a>
        </div>
    </header>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="content-grid">
            <!-- Left Panel: Break Actions -->
            <div class="panel panel-main">
                <div class="panel-content">
                    <!-- Status -->
                    <div class="status-box {% if active_break %}status-on-break{% else %}status-at-work{% endif %}" id="statusBox">
                        {% if active_break %}
                            <span id="statusText">â³ On Break (<span id="elapsedTime">{{ active_break.get_elapsed_minutes() }}</span> min)</span>
                        {% else %}
                            <span id="statusText">ğŸŸ¢ Status: At Work</span>
                        {% endif %}
                    </div>
                    
                    <!-- Break Type Selection -->
                    <h3>Select Break Type:</h3>
                    <div class="break-types" id="breakTypes">
                        {% for key, info in break_types.items() %}
                        <button type="button" class="break-type-btn {% if active_break %}disabled{% endif %}" 
                                data-type="{{ key }}"
                                style="--break-color: {{ info.color }}">
                            <span class="emoji">{{ info.emoji }}</span>
                            <span class="name">{{ info.name }}</span>
                            <span class="duration">({{ break_durations[key] }} min)</span>
                        </button>
                        {% endfor %}
                    </div>
                    
                    <!-- Screenshot Upload -->
                    <h3>Upload Screenshot:</h3>
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-content">
                            <div class="upload-icon" id="uploadIcon">ğŸ“·</div>
                            <p>Browse file or Paste from clipboard (Ctrl+V)</p>
                            <div class="upload-buttons">
                                <label class="btn btn-primary">
                                    ğŸ“ Browse
                                    <input type="file" id="fileInput" accept="image/*" hidden>
                                </label>
                                <button type="button" class="btn btn-secondary" id="pasteBtn">ğŸ“‹ Paste</button>
                            </div>
                        </div>
                    </div>
                    <p class="selected-file" id="selectedFile"></p>
                    
                    <!-- Submit Button -->
                    <button type="button" class="btn btn-primary btn-block btn-large" id="submitBtn" disabled>
                        {% if active_break %}
                            ğŸ Submit Break End
                        {% else %}
                            ğŸš€ Submit Break Start
                        {% endif %}
                    </button>
                    
                    <p class="message" id="message"></p>
                </div>
            </div>
            
            <!-- Right Panel: Today's History -->
            <div class="panel panel-sidebar">
                <div class="panel-header">
                    <h3>ğŸ“‹ Today's Breaks</h3>
                    <button class="btn btn-icon" onclick="location.reload()">ğŸ”„</button>
                </div>
                <div class="panel-content">
                    <div class="break-history" id="breakHistory">
                        {% if today_breaks %}
                            {% for br in today_breaks %}
                            <div class="history-card {% if br.is_active() %}active{% elif br.is_overdue %}overdue{% else %}completed{% endif %}">
                                <div class="history-info">
                                    <span class="history-type">{{ br.get_break_info().emoji }} {{ br.start_time.strftime('%I:%M %p') }}</span>
                                    {% if br.end_time %}
                                        <span> â†’ {{ br.end_time.strftime('%I:%M %p') }}</span>
                                    {% else %}
                                        <span> â†’ â³ On Break...</span>
                                    {% endif %}
                                </div>
                                <div class="history-status">
                                    {% if br.is_active() %}
                                        ({{ br.get_elapsed_minutes() }} min elapsed)
                                    {% elif br.is_overdue %}
                                        ({{ br.duration_minutes }} min) âš ï¸
                                    {% else %}
                                        ({{ br.duration_minutes }} min) âœ…
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <p class="empty-message">No breaks recorded today</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Pass data to JavaScript
    window.agentData = {
        hasActiveBreak: {% if active_break %}true{% else %}false{% endif %},
        activeBreakId: {% if active_break %}{{ active_break.id }}{% else %}null{% endif %},
        activeBreakStart: {% if active_break %}"{{ active_break.start_time.isoformat() }}"{% else %}null{% endif %}
    };
</script>
{% endblock %}

